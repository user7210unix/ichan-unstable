<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soyjak Board</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        board: {
                            fgPrimary: '#ffffff',
                            fgAccent: '#70C1B3',
                            fgSecondary: '#D4ECE8',
                            bgPrimary: '#040B0F',
                            bgSecondary: '#0b1b2e',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.15)',
                    },
                    animation: {
                        'slide-in': 'slideIn 0.5s ease-out',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateY(15px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(to bottom, #040B0F, #0b1b2e);
        }
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .post-content img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }
        .post-content a {
            color: #70C1B3;
            text-decoration: underline;
            transition: color 0.2s ease;
        }
        .post-content a:hover {
            color: #D4ECE8;
        }
        .post-content pre {
            background-color: #0b1b2e;
            padding: 12px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9rem;
            color: #D4ECE8;
        }
        .post-content code {
            font-family: 'Consolas', monospace;
            background-color: #0b1b2e;
            padding: 3px 6px;
            border-radius: 4px;
            color: #D4ECE8;
        }
        .flag {
            font-size: 1.2em;
            margin-right: 6px;
        }
        .thread-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .thread-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        .thread-image {
            transition: transform 0.3s ease;
        }
        .thread-card:hover .thread-image {
            transform: scale(1.03);
        }
        .navbar {
            backdrop-filter: blur(10px);
            background-color: rgba(11, 27, 46, 0.95);
            border-bottom: 1px solid rgba(112, 193, 179, 0.2);
        }
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: #70C1B3;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }
        .dropdown:hover .dropdown-menu {
            display: block;
        }
        .board-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .board-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        .spoiler {
            background-color: #040B0F;
            color: #040B0F;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .spoiler:hover {
            color: #D4ECE8;
        }
        .btn-accent {
            background: #70C1B3;
            transition: background 0.3s ease, transform 0.2s ease;
        }
        .btn-accent:hover {
            background: #D4ECE8;
            transform: translateY(-1px);
        }
        h2, h3 {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-board-bgPrimary text-board-fgPrimary min-h-screen font-sans">
    <header class="navbar sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-4">
                <a href="#" id="home-link" class="text-3xl font-bold text-board-fgPrimary hover:text-board-fgAccent transition nav-link">
                    Soyjak
                </a>
                <div class="hidden md:flex space-x-2">
                    <button id="refresh-btn" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition" title="Refresh">
                        <i class="fas fa-sync-alt text-board-fgSecondary"></i>
                    </button>
                    <button id="theme-toggle" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition" title="Toggle Theme">
                        <i class="fas fa-moon text-board-fgSecondary"></i>
                    </button>
                </div>
            </div>
            <nav class="flex items-center space-x-6">
                <div class="dropdown relative">
                    <button class="flex items-center space-x-1 text-board-fgPrimary hover:text-board-fgAccent transition nav-link">
                        <span>Boards</span>
                        <i class="fas fa-chevron-down text-xs"></i>
                    </button>
                    <div class="dropdown-menu absolute hidden right-0 mt-2 w-72 bg-board-bgSecondary rounded-lg shadow-xl border border-board-fgAccent/20 py-2 z-50">
                        <div id="quick-boards" class="grid grid-cols-1 gap-2 p-3">
                            <!-- Boards will be populated here -->
                        </div>
                    </div>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="https://soyjak.st/rules.html" class="text-board-fgPrimary hover:text-board-fgAccent transition nav-link" target="_blank">
                        Rules
                    </a>
                    <a href="https://booru.soyjak.st" class="text-board-fgPrimary hover:text-board-fgAccent transition nav-link" target="_blank">
                        Soybooru
                    </a>
                    <a href="https://wiki.soyjak.st" class="text-board-fgPrimary hover:text-board-fgAccent transition nav-link" target="_blank">
                        Wiki
                    </a>
                </div>
                <button id="mobile-menu-btn" class="md:hidden px-3 py-2 text-board-fgPrimary">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>
    <main class="container mx-auto px-4 py-8">
        <!-- Start Page -->
        <section id="startpage" class="fade-in">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-board-fgPrimary">
                    Trending Threads
                </h2>
                <div class="flex space-x-2">
                    <button id="view-grid" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition">
                        <i class="fas fa-th-large text-board-fgSecondary"></i>
                    </button>
                    <button id="view-list" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition">
                        <i class="fas fa-list text-board-fgSecondary"></i>
                    </button>
                </div>
            </div>
            <div id="trending-threads" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-48 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-48 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5 sm:hidden lg:block">
                    <div class="h-48 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5 hidden xl:block">
                    <div class="h-48 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                </div>
            </div>
            <h2 class="text-3xl font-bold text-board-fgPrimary mt-12 mb-8">
                Boards
            </h2>
            <div id="boards-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5 hidden lg:block">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5 hidden xl:block">
                    <div class="h-32 bg-board-bgPrimary rounded-lg mb-4"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-board-bgPrimary rounded w-full"></div>
                </div>
            </div>
        </section>
        <!-- Board Page -->
        <section id="board-page" class="hidden fade-in">
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center space-x-4">
                    <button id="back-to-home" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition">
                        <i class="fas fa-arrow-left mr-2 text-board-fgSecondary"></i>Home
                    </button>
                    <h2 id="board-title" class="text-3xl font-bold text-board-fgPrimary">
                        /board/
                    </h2>
                </div>
                <button id="new-thread-btn" class="px-5 py-2 btn-accent text-board-bgPrimary rounded-lg font-semibold transition">
                    <i class="fas fa-plus mr-2"></i>New Thread
                </button>
            </div>
            <div id="threads-container" class="space-y-6">
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="flex">
                        <div class="h-20 w-20 bg-board-bgPrimary rounded-lg mr-4"></div>
                        <div class="flex-1">
                            <div class="h-6 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                        </div>
                    </div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="flex">
                        <div class="h-20 w-20 bg-board-bgPrimary rounded-lg mr-4"></div>
                        <div class="flex-1">
                            <div class="h-6 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-full mb-2"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-2/3"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="board-loading" class="text-center py-10">
                <i class="fas fa-spinner fa-spin text-3xl text-board-fgAccent"></i>
                <p class="mt-3 text-lg text-board-fgSecondary">Loading threads...</p>
            </div>
        </section>
        <!-- Thread Page -->
        <section id="thread-page" class="hidden fade-in">
            <div class="mb-8">
                <button id="back-to-board" class="px-4 py-2 rounded bg-board-bgSecondary hover:bg-board-fgAccent/20 transition">
                    <i class="fas fa-arrow-left mr-2 text-board-fgSecondary"></i>Back to Board
                </button>
                <h2 id="thread-title" class="text-3xl font-bold text-board-fgPrimary mt-6">
                    Thread #12345 on /board/
                </h2>
            </div>
            <div id="posts-container" class="space-y-6">
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="flex mb-4">
                        <div class="h-12 w-12 bg-board-bgPrimary rounded-full mr-4"></div>
                        <div>
                            <div class="h-5 bg-board-bgPrimary rounded w-32 mb-3"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-24"></div>
                        </div>
                    </div>
                    <div class="h-5 bg-board-bgPrimary rounded w-full mb-3"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-64 bg-board-bgPrimary rounded-lg"></div>
                </div>
                <div class="animate-pulse bg-board-bgSecondary rounded-lg p-5">
                    <div class="flex mb-4">
                        <div class="h-12 w-12 bg-board-bgPrimary rounded-full mr-4"></div>
                        <div>
                            <div class="h-5 bg-board-bgPrimary rounded w-32 mb-3"></div>
                            <div class="h-4 bg-board-bgPrimary rounded w-24"></div>
                        </div>
                    </div>
                    <div class="h-5 bg-board-bgPrimary rounded w-full mb-3"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-3/4 mb-3"></div>
                    <div class="h-5 bg-board-bgPrimary rounded w-1/2"></div>
                </div>
            </div>
            <div id="thread-loading" class="text-center py-10">
                <i class="fas fa-spinner fa-spin text-3xl text-board-fgAccent"></i>
                <p class="mt-3 text-lg text-board-fgSecondary">Loading posts...</p>
            </div>
        </section>
    </main>
    <footer class="bg-board-bgSecondary border-t border-board-fgAccent/20 py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <h3 class="text-xl font-bold text-board-fgPrimary mb-3">Soyjak Board</h3>
                    <p class="text-sm text-board-fgSecondary">A modern interface for soyjak.st</p>
                </div>
                <div class="flex space-x-8">
                    <a href="#" class="text-board-fgSecondary hover:text-board-fgAccent transition nav-link">About</a>
                    <a href="#" class="text-board-fgSecondary hover:text-board-fgAccent transition nav-link">FAQ</a>
                    <a href="#" class="text-board-fgSecondary hover:text-board-fgAccent transition nav-link">Contact</a>
                    <a href="#" class="text-board-fgSecondary hover:text-board-fgAccent transition nav-link">GitHub</a>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-board-fgAccent/20 text-center text-sm text-board-fgSecondary">
                <p>This is an unofficial interface. All content is from soyjak.st</p>
                <p class="mt-2">© 2025 Soyjak Board - Not affiliated with soyjak.st</p>
            </div>
        </div>
    </footer>
    <script>
        // Configuration
        const config = {
            corsProxy: 'https://cors-anywhere.herokuapp.com/',
            defaultView: 'grid',
            boards: [
                { board: 'soy', title: '/soy/', description: 'Main board' },
                { board: 'pol', title: '/pol/', description: 'Politics' },
                { board: 'a', title: '/a/', description: 'Anime' },
                { board: 'v', title: '/v/', description: 'Video Games' },
                { board: 'tv', title: '/tv/', description: 'Television' },
                { board: 'fit', title: '/fit/', description: 'Fitness' },
                { board: 'biz', title: '/biz/', description: 'Business' },
                { board: 'tech', title: '/tech/', description: 'Technology' },
                { board: 'int', title: '/int/', description: 'International' },
                { board: 'qa', title: '/qa/', description: 'Questions' },
                { board: 'r9k', title: '/r9k/', description: 'Robots' },
                { board: 'x', title: '/x/', description: 'Paranormal' },
                { board: 'nate', title: '/nate/', description: 'Nate' },
                { board: 'sude', title: '/sude/', description: 'Sude' },
                { board: 'chive', title: '/chive/', description: 'Chive' },
                { board: 'q', title: '/q/', description: 'LGBTQ+' },
                { board: 'news', title: '/news/', description: 'News' },
                { board: 'mtv', title: '/mtv/', description: 'Music/TV' }
            ]
        };

        // State management
        let currentState = {
            board: null,
            thread: null,
            viewMode: config.defaultView,
            darkMode: true
        };

        // DOM Elements
        const elements = {
            startpage: document.getElementById('startpage'),
            boardPage: document.getElementById('board-page'),
            threadPage: document.getElementById('thread-page'),
            trendingThreads: document.getElementById('trending-threads'),
            boardsGrid: document.getElementById('boards-grid'),
            threadsContainer: document.getElementById('threads-container'),
            postsContainer: document.getElementById('posts-container'),
            boardTitle: document.getElementById('board-title'),
            threadTitle: document.getElementById('thread-title'),
            homeLink: document.getElementById('home-link'),
            backToHome: document.getElementById('back-to-home'),
            backToBoard: document.getElementById('back-to-board'),
            viewGrid: document.getElementById('view-grid'),
            viewList: document.getElementById('view-list'),
            refreshBtn: document.getElementById('refresh-btn'),
            themeToggle: document.getElementById('theme-toggle'),
            quickBoards: document.getElementById('quick-boards'),
            boardLoading: document.getElementById('board-loading'),
            threadLoading: document.getElementById('thread-loading')
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadBoards();
            loadTrendingThreads();
            checkThemePreference();
        });

        // Event Listeners
        function setupEventListeners() {
            elements.homeLink.addEventListener('click', (e) => {
                e.preventDefault();
                showStartPage();
            });
            elements.backToHome.addEventListener('click', (e) => {
                e.preventDefault();
                showStartPage();
            });
            elements.backToBoard.addEventListener('click', (e) => {
                e.preventDefault();
                if (currentState.board) {
                    showBoardPage(currentState.board);
                }
            });
            elements.viewGrid.addEventListener('click', (e) => {
                e.preventDefault();
                setViewMode('grid');
            });
            elements.viewList.addEventListener('click', (e) => {
                e.preventDefault();
                setViewMode('list');
            });
            elements.refreshBtn.addEventListener('click', (e) => {
                e.preventDefault();
                refreshContent();
            });
            elements.themeToggle.addEventListener('click', (e) => {
                e.preventDefault();
                toggleTheme();
            });
        }

        // View Management
        function showStartPage() {
            elements.startpage.classList.remove('hidden');
            elements.boardPage.classList.add('hidden');
            elements.threadPage.classList.add('hidden');
            currentState.board = null;
            currentState.thread = null;
        }

        function showBoardPage(board) {
            currentState.board = board;
            currentState.thread = null;
            elements.startpage.classList.add('hidden');
            elements.boardPage.classList.remove('hidden');
            elements.threadPage.classList.add('hidden');
            elements.boardTitle.textContent = `/${board}/`;
            loadBoardThreads(board);
        }

        function showThreadPage(board, threadId) {
            console.log(`Opening thread #${threadId} on /${board}/`);
            if (!board) {
                console.error('Board is undefined in showThreadPage');
                elements.postsContainer.innerHTML = `
                    <div class="text-center py-10 text-red-400">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Invalid board
                    </div>
                `;
                return;
            }
            currentState.board = board;
            currentState.thread = threadId;
            elements.startpage.classList.add('hidden');
            elements.boardPage.classList.add('hidden');
            elements.threadPage.classList.remove('hidden');
            elements.threadTitle.textContent = `Thread #${threadId} on /${board}/`;
            loadThreadPosts(board, threadId);
        }

        function setViewMode(mode) {
            currentState.viewMode = mode;
            if (mode === 'grid') {
                elements.viewGrid.classList.add('bg-board-fgAccent/20');
                elements.viewList.classList.remove('bg-board-fgAccent/20');
                elements.trendingThreads.classList.remove('grid-cols-1');
                elements.trendingThreads.classList.add('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
            } else {
                elements.viewGrid.classList.remove('bg-board-fgAccent/20');
                elements.viewList.classList.add('bg-board-fgAccent/20');
                elements.trendingThreads.classList.remove('sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4');
                elements.trendingThreads.classList.add('grid-cols-1');
            }
        }

        // Theme Management
        function checkThemePreference() {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            currentState.darkMode = prefersDark;
            applyTheme();
        }

        function toggleTheme() {
            currentState.darkMode = !currentState.darkMode;
            applyTheme();
        }

        function applyTheme() {
            if (currentState.darkMode) {
                document.documentElement.classList.add('dark');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.documentElement.classList.remove('dark');
                elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Content Loading
        function loadBoards() {
            elements.boardsGrid.innerHTML = '';
            config.boards.forEach(board => {
                const boardElement = document.createElement('div');
                boardElement.className = 'board-card bg-board-bgSecondary hover:bg-board-bgSecondary/80 rounded-lg p-5 transition cursor-pointer shadow-card slide-in';
                boardElement.innerHTML = `
                    <h3 class="text-xl font-semibold text-board-fgPrimary mb-2">${board.title}</h3>
                    <p class="text-sm text-board-fgSecondary">${board.description}</p>
                `;
                boardElement.addEventListener('click', () => showBoardPage(board.board));
                elements.boardsGrid.appendChild(boardElement);
            });
            elements.quickBoards.innerHTML = '';
            config.boards.forEach(board => {
                const boardLink = document.createElement('a');
                boardLink.href = '#';
                boardLink.className = 'block px-4 py-2 hover:bg-board-fgAccent/20 transition';
                boardLink.innerHTML = `
                    <span class="font-medium text-board-fgPrimary">${board.title}</span>
                    <span class="text-xs text-board-fgSecondary ml-2">${board.description}</span>
                `;
                boardLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showBoardPage(board.board);
                });
                elements.quickBoards.appendChild(boardLink);
            });
        }

        async function loadTrendingThreads() {
            elements.trendingThreads.innerHTML = '<div class="col-span-full text-center py-10"><i class="fas fa-spinner fa-spin text-3xl text-board-fgAccent"></i><p class="mt-3 text-lg text-board-fgSecondary">Loading trending threads...</p></div>';
            try {
                const sampleBoards = ['soy', 'a', 'v', 'pol', 'tv'];
                const promises = sampleBoards.map(board => fetchBoardCatalog(board));
                const results = await Promise.all(promises);
                let allThreads = [];
                results.forEach((threads, index) => {
                    if (threads && threads.length > 0) {
                        threads.forEach(thread => {
                            thread.board = sampleBoards[index];
                            allThreads.push(thread);
                        });
                    }
                });
                allThreads.sort((a, b) => (b.replies || 0) - (a.replies || 0));
                if (allThreads.length === 0) {
                    elements.trendingThreads.innerHTML = '<div class="col-span-full text-center py-10 text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>No trending threads found. API response may be empty or invalid.</div>';
                    return;
                }
                displayTrendingThreads(allThreads.slice(0, 8));
            } catch (error) {
                console.error('Error loading trending threads:', error);
                elements.trendingThreads.innerHTML = '<div class="col-span-full text-center py-10 text-red-400"><i class="fas fa-exclamation-triangle mr-2"></i>Failed to load trending threads: ' + error.message + '</div>';
            }
        }

        function displayTrendingThreads(threads) {
            elements.trendingThreads.innerHTML = '';
            threads.forEach(thread => {
                const threadElement = document.createElement('div');
                threadElement.className = 'thread-card bg-board-bgSecondary rounded-lg overflow-hidden transition cursor-pointer shadow-card slide-in';
                let imageHtml = '';
                if (thread.image && thread.image.thumbnail) {
                    imageHtml = `
                        <div class="relative h-48 overflow-hidden">
                            <img src="${config.corsProxy}${thread.image.thumbnail}" alt="Thread image" class="thread-image w-full h-full object-cover">
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-board-bgPrimary/80 to-transparent p-4">
                                <span class="text-xs font-medium bg-board-fgAccent/80 px-2 py-1 rounded">/${thread.board}/</span>
                                <h3 class="text-board-fgPrimary font-semibold mt-2 truncate">${thread.subject || 'No subject'}</h3>
                            </div>
                        </div>
                    `;
                } else {
                    imageHtml = `
                        <div class="h-48 bg-board-bgPrimary flex items-center justify-center">
                            <i class="fas fa-image text-4xl text-board-fgSecondary"></i>
                        </div>
                    `;
                }
                threadElement.innerHTML = `
                    ${imageHtml}
                    <div class="p-5">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm text-board-fgSecondary">#${thread.no}</span>
                            <span class="text-xs bg-board-bgPrimary px-2 py-1 rounded text-board-fgSecondary">${thread.replies || 0} replies</span>
                        </div>
                        <p class="text-sm line-clamp-2 text-board-fgSecondary">${thread.com ? formatPostText(thread.com) : 'No content'}</p>
                    </div>
                `;
                threadElement.addEventListener('click', () => showThreadPage(thread.board, thread.no));
                elements.trendingThreads.appendChild(threadElement);
            });
        }

        async function loadBoardThreads(board) {
            elements.threadsContainer.innerHTML = '';
            elements.boardLoading.classList.remove('hidden');
            try {
                const threads = await fetchBoardCatalog(board);
                if (threads.length === 0) {
                    elements.threadsContainer.innerHTML = `
                        <div class="text-center py-10 text-red-400">
                            <i class="fas fa-exclamation-triangle mr-2"></i>No threads found for /${board}/. Check API response in console.
                        </div>
                    `;
                    return;
                }
                displayBoardThreads(threads, board);
            } catch (error) {
                console.error(`Error loading /${board}/ threads:`, error);
                elements.threadsContainer.innerHTML = `
                    <div class="text-center py-10 text-red-400">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Failed to load threads: ${error.message}
                    </div>
                `;
            } finally {
                elements.boardLoading.classList.add('hidden');
            }
        }

        function displayBoardThreads(threads, board) {
            elements.threadsContainer.innerHTML = '';
            if (!threads || threads.length === 0) {
                elements.threadsContainer.innerHTML = `
                    <div class="text-center py-10 text-board-fgSecondary">
                        <i class="fas fa-comment-slash mr-2"></i>No threads found
                    </div>
                `;
                return;
            }
            threads.forEach(thread => {
                const threadElement = document.createElement('div');
                threadElement.className = 'thread-item bg-board-bgSecondary hover:bg-board-bgSecondary/80 rounded-lg p-5 transition cursor-pointer shadow-card slide-in';
                let imageHtml = '';
                if (thread.image && thread.image.thumbnail) {
                    imageHtml = `
                        <div class="flex-shrink-0 mr-4">
                            <img src="${config.corsProxy}${thread.image.thumbnail}" alt="Thread image" class="thread-image w-20 h-20 object-cover rounded-lg">
                        </div>
                    `;
                }
                threadElement.innerHTML = `
                    <div class="flex">
                        ${imageHtml}
                        <div class="flex-1">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h3 class="text-lg font-semibold text-board-fgPrimary">${thread.subject || 'No subject'}</h3>
                                    <div class="flex items-center text-sm text-board-fgSecondary">
                                        <span>#${thread.no}</span>
                                        <span class="mx-2">•</span>
                                        <span>${thread.replies || 0} replies</span>
                                    </div>
                                </div>
                                <span class="text-xs bg-board-bgPrimary px-2 py-1 rounded text-board-fgSecondary">/${thread.board}/</span>
                            </div>
                            <p class="text-sm line-clamp-3 text-board-fgSecondary">${thread.com ? formatPostText(thread.com) : 'No content'}</p>
                        </div>
                    </div>
                `;
                threadElement.addEventListener('click', () => showThreadPage(board, thread.no));
                elements.threadsContainer.appendChild(threadElement);
            });
        }

        async function loadThreadPosts(board, threadId) {
            elements.postsContainer.innerHTML = '';
            elements.threadLoading.classList.remove('hidden');
            try {
                const posts = await fetchThreadPosts(board, threadId);
                if (posts.length === 0) {
                    elements.postsContainer.innerHTML = `
                        <div class="text-center py-10 text-red-400">
                            <i class="fas fa-exclamation-triangle mr-2"></i>No posts found for thread #${threadId}. Check API response in console.
                        </div>
                    `;
                    return;
                }
                displayThreadPosts(posts);
            } catch (error) {
                console.error(`Error loading thread #${threadId} on /${board}/:`, error);
                elements.postsContainer.innerHTML = `
                    <div class="text-center py-10 text-red-400">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Failed to load posts: ${error.message}
                    </div>
                `;
            } finally {
                elements.threadLoading.classList.add('hidden');
            }
        }

        function displayThreadPosts(posts) {
            elements.postsContainer.innerHTML = '';
            if (!posts || posts.length === 0) {
                elements.postsContainer.innerHTML = `
                    <div class="text-center py-10 text-board-fgSecondary">
                        <i class="fas fa-comment-slash mr-2"></i>No posts found
                    </div>
                `;
                return;
            }
            posts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post bg-board-bgSecondary rounded-lg p-5 shadow-card slide-in';
                let imageHtml = '';
                if (post.image && post.image.url) {
                    imageHtml = `
                        <div class="post-content">
                            <img src="${config.corsProxy}${post.image.url}" alt="Post image" class="mt-4">
                        </div>
                    `;
                }
                const flagHtml = post.country ? `<span class="flag">${post.country}</span>` : '';
                postElement.innerHTML = `
                    <div class="flex mb-4">
                        <div class="flex-shrink-0">
                            <div class="h-12 w-12 bg-board-bgPrimary rounded-full"></div>
                        </div>
                        <div class="ml-4">
                            <div class="flex items-center">
                                ${flagHtml}
                                <span class="font-semibold text-board-fgPrimary">${post.name || 'Anonymous'}</span>
                                <span class="text-sm text-board-fgSecondary ml-2">No. ${post.no}</span>
                            </div>
                            <span class="text-xs text-board-fgSecondary">${post.time}</span>
                        </div>
                    </div>
                    <div class="post-content">
                        <p class="text-board-fgSecondary">${post.com ? formatPostText(post.com) : 'No content'}</p>
                        ${imageHtml}
                    </div>
                `;
                elements.postsContainer.appendChild(postElement);
            });
        }

        async function fetchBoardCatalog(board) {
            try {
                const response = await fetch(`${config.corsProxy}https://soyjak.st/${board}/catalog.json`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}, StatusText: ${response.statusText}`);
                }
                const data = await response.json();
                console.log(`Raw API response for /${board}/catalog.json:`, data);
                if (data.length > 0 && data[0].threads && data[0].threads.length > 0) {
                    console.log(`Sample thread data for /${board}/:`, data[0].threads[0]);
                }

                let threads = [];
                if (Array.isArray(data)) {
                    threads = data.flatMap(page => page.threads || []);
                } else if (data.threads) {
                    threads = data.threads;
                } else if (data.posts) {
                    threads = data.posts;
                } else {
                    console.error(`Unexpected API response structure for /${board}/catalog.json:`, data);
                    throw new Error('Invalid API response structure: No threads or posts found');
                }

                if (!Array.isArray(threads)) {
                    console.error(`Threads data is not an array for /${board}/catalog.json:`, threads);
                    throw new Error('Invalid threads data: Expected an array');
                }

                return threads.map(thread => ({
                    no: thread.no,
                    subject: thread.sub,
                    com: thread.com,
                    replies: thread.replies,
                    board: board,
                    image: thread.tim && thread.ext ? {
                        thumbnail: `https://soyjak.st/${board}/thumb/${thread.tim}s.jpg`,
                        url: `https://soyjak.st/${board}/src/${thread.tim}.${thread.ext}`
                    } : null
                }));
            } catch (error) {
                console.error(`Error fetching /${board}/ catalog:`, error);
                return [];
            }
        }

        async function fetchThreadPosts(board, threadId) {
            if (!board) {
                throw new Error('Board is undefined');
            }
            try {
                const response = await fetch(`${config.corsProxy}https://soyjak.st/${board}/res/${threadId}.json`, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}, StatusText: ${response.statusText}`);
                }
                const data = await response.json();
                console.log(`Raw API response for /${board}/res/${threadId}.json:`, data);

                const posts = data.posts || [];
                if (!Array.isArray(posts)) {
                    console.error(`Posts data is not an array for thread #${threadId} on /${board}/:`, posts);
                    throw new Error('Invalid posts data: Expected an array');
                }

                return posts.map(post => ({
                    no: post.no,
                    name: post.name,
                    com: post.com,
                    time: new Date(post.time * 1000).toLocaleString(),
                    country: post.country_name,
                    image: post.tim && post.ext ? {
                        url: `https://soyjak.st/${board}/src/${post.tim}.${post.ext}`,
                        thumbnail: `https://soyjak.st/${board}/thumb/${post.tim}s.jpg`
                    } : null
                }));
            } catch (error) {
                console.error(`Error fetching thread #${threadId} on /${board}/:`, error);
                throw error;
            }
        }

        function formatPostText(text) {
            if (!text) return '';
            text = text.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            text = text.replace(/^>.*$/gm, match => `<span class="text-board-fgAccent">${match}</span>`);
            text = text.replace(/\|\|(.*?)\|\|/g, '<span class="spoiler">$1</span>');
            text = text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
            text = text.replace(/\n/g, '<br>');
            return text;
        }

        function refreshContent() {
            if (currentState.thread) {
                loadThreadPosts(currentState.board, currentState.thread);
            } else if (currentState.board) {
                loadBoardThreads(currentState.board);
            } else {
                loadTrendingThreads();
            }
        }
    </script>
</body>
</html>
